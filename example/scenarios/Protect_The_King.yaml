# В структуре "objects" перечислены объекты, 
# определенные для данного сценария. Объектами могут быть:
# игрок, неподвижные безжизненные NPC. 

# Общая вид любой структуры объекта:
# <object id>: 
#   type: <object type>
#   x: <starting position of X-axis>
#   y: <starting position of Y-axis>
# Если поля не указаны явно, то их значения инициализируются 
# значениями по умолчанию (не для всех полей существуют такие значения).
# По умолчанию поля x и y равны нулю.
# Объект с id "player" является объектом, управляемым игроком.

# Для любого объекта определены методы, обращение к ним возможно через 
# символ определения контекста '.':
# ("bool" означает, что данный метод используется только в качестве условия)
# ("void" означает, что данный метод используется только в качестве действия) 
# -----/ bool in(x y) - возращает true, если объект находится в позиции (x, y);

objects:
 player: 
  type: Dwarf
  x: 1
  y: 1
  
# События представляют собой последовательность действий,
# которые могут быть выполнены, если удовлетворяют своему условию.
# Проверка событий происходит каждый ход.
# Структура "events" задает список этих событий вместе с их определениями.

# Общий вид любой структуры события:
# <event id>
#   if: [<condition>, <condition>, ..., <condition>] 
#   title:   <window title>
#   message: <window message>
#   size: <window size>
#   image: 
#     file: <image file>
#   items:
#     - 
#       label: <item label>
#       do: [<item action>, <item action>, ..., <item action>]
#     -
#       label: ...
#       do: ...
#     - 
#       ...
#
#   do: [<action>, <action>, ..., <action>]
#

# Если не указаны условия (структура "if"), то событие выполняется каждый ход.
# Если указаны условия, то, событие выполнится, если выполняются одновременно все условия.
# Структура "if" также может содержать вложенные последовательности. (!)
# if: [ false ] - событие выполнится, если это сделать явно (см. методы событий)
# if: [ true ] - явно указываем, что событие будет выполняться каждый ход (по умолчанию, если if не определен)
# Ключевое действие "or" (поле <condition>) позволяет управлять списком условий,
# разделяя список условий на две части, выполнение любой части ведет к выполнению события.
# События могут быть вложенными [[<cond>, <cond>], or <cond>].
#
# Поле "title" устанавливает заголовок окна с сообщением.
#
# Полe "size" устанавливает размер этого окна, по умолчанию - "Small"
# Варианты: "Small", "Average", "Full"
#
# Поле "image" устанавливает ASCII-картинку, которая появится в окне с сообщением, по умолчанию картинка отсутствует.
# Картинка представляет собой просто текстовый файл.

# Поле "image: file <file>" - устанавливает файл с картинкой

# Поле "message" устанавливает сообщение, выводящееся, при выполнении события. Если
# это поле оставить пустым, то сообщение не выведется, при этом выполнятся действия из поля "do". (!)

# Поле "color" устанавливает статус (цвет) окна события, по умолчание "Neutral".
# Варианты: "Hostile", "Neutral", "Friend"

# Поле "do" содержит методы, которые будут вызваны, если событием
# не вызывает диалогового окна

# Методы определенные для каждого события:
# -----/ bool happened() - возвращает true, если событие уже произошло;
# -----/ bool happened(int X) - возвращает true, если событие произошло X шагов назад;
# -----/ void run() - запускает событие, независимо от его условий;

events:
  ev1:                                        
    if: [ ev1.happened()!, [player.in(1 2), or, player.in(2 1), or, player.in(2 2)]] 
    title:   "Example"                           
    size:    "Average"
    message: "Praise the gods, you came to the rescue! They are about to break into the King's chambers! Hurry up!" 
    image: 
      file: "Pikeman"
    color: "Friend"
    items:                                     
       -                                    
         label: "For the King!" 
         do:    [ dialog.close() ]        
       -
         label: "I guess I'll go from here..."              
         do:    [ scenario.exit() ]  
  
  # Событие-флаг
  flag:
    if: [player.in(11 3), or, player.in(10 3), or, player.in(9 3), or, player.in(1 4), or, player.in(2, 4), or, player.in(3 4), or, player.in(4 4)]    
    do: [ ] 

  ambush:
    if: [ flag.happened(20) ]    
    size: "Average"
    image: 
      file: "Devil"
    color: "Hostile"
    items:
       -
         label: "OK"
         do: [ dialog.close(), death.run() ]
    message: "The king is dead... Now it's your turn to die."
    
  death: 
    if: [ false ]
    size: "Small"
    items:
       -
         label: "OK"
         do: [ scenario.exit() ]
    message: "You die..."
    color: "Hostile"
        
# "scenario" зарезервированное имя,его нельзя 
# использовать в качестве названия объектов/событий/карт.
# Зарезервированное имя "scenario" позволяет обращаться к 
# методам определенных для всего сценария:
# -----/ void exit() - выход в главное меню (подразумевает удаление всего текущего стека окон);

# "dialog" зарезервированное имя, его нельзя использовать
# в качестве названия любых объектов сценария.
# "dialog" позволяет обращаться к методам,
# управляющих поведением диалогового окна:
# -----/ void close() - закрыть диалоговое окно 

# Структура "maps" определяет список карт сценария.

# Общий вид структуры карты:
# <map id>
#   width:  <map width>
#   height: <map height>
#   text:   <map>

maps:
 map1:
  width: 59
  height: 18
  text: |
   ###########################################################
   #...........#.............................................#
   #...........#........#....................................#
   #.....................#...................................#
   #....####.....).)......#..................................#
   #.......#.)..)()................#####################.....#
   #).()(..#....(......................................#.....#
   #.(...).#.)(...)....##..............................#.....#
   #####........#......##..........##################..#.....#
   #...#...........................#................#..#.....#
   #...#............#..............#................#..#.....#
   #...............................#..###############..#.....#
   #...............................#...................#.....#
   #...............................#...................#.....#
   #...............................#####################.....#
   #.........................................................#
   #.........................................................#
   ###########################################################
